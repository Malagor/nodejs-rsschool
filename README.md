# Task 9. NestJS

### Author: Alex Malagor

- Description https://github.com/rolling-scopes-school/basic-nodejs-2021Q2/blob/master/descriptions/nestjs.md
- Cross-check https://github.com/rolling-scopes-school/basic-nodejs-2021Q2/blob/master/cross-check/nestjs.md

| done         | deadline   |
|-------------|------------|
|11.07.2021 | 11.07.2021 |

### Информация
Приложение работает в докере. 
При запуске приложение создает базу данных, запускает миграции и записывает пользователя "admin" в таблицу `users`. То есть можно сразу запускать тесты без дополнительных телодвижений.
База данных размещается в отдельном томе в папке` ./database/data`

### Перед запуском - установка режима запуска приложения (express-fastify)
Выбрать режим можно установив его в файле `.env`.
Для смены режима нужно предварительно остановить докер, установить нужный режим и заново запустить согласно инструкции ниже.

![image](https://user-images.githubusercontent.com/20399054/125208738-049be300-e29d-11eb-81b1-ee367a03423b.png)

Режим запуска можно увидеть при старте сервера 

![image](https://user-images.githubusercontent.com/20399054/125208712-db7b5280-e29c-11eb-801a-481992e9954f.png)




### Инструкция
- Перейти в папку с проектом
- Переключиться в нужную git ветку `git checkout task9/nest`
- Установить зависимости `npm install`
- Запустить проект в докере `npm run docker:up`.
- В другой консоли запустить тесты `npm run test:auth`
- Для остановки докера можно воспользоваться командой `npm run docker:down`
- Возможно при первом запуске потребуется несколько перезагрузок, прежде чем стартанет база данных.
- В случае вопросов буду благодарен если сперва свяжетесь со мной для уточнения деталей. Дискорд @Malagor#6535

## Самопроверка [240/240]
- [x] `Guards` должны использоваться для работы с авторизацией/аутентификацией **+30 баллов**
- [x]  В приложении должны использоваться модули для разбиения структуры приложения на различные части (`User`, `Board`, `Task`) **+30 баллов**
- [x] `Exception filters` должны использоваться для обработки исключений в приложении **+30 баллов**
- [x] `@nestjs/typeorm` должен использоваться для работы с базой данных **+30 баллов**
- [x]  Для логирования может использоваться встроенный `Logger` или кастомная имплементация. **+30 баллов**
- [x] Все внешние зависимости для модулей/классов должны предоставляться с помощью механизма `dependency injection`. **+30 баллов**
- [x]  В зависисимости от env переменной `USE_FASTIFY` `Nest.js` должен использовать или `express` или `fastify` **+30 баллов**
- [x]  Необходимо сравнить производительность `Nest.js` с использованием `express` и `fastify` (можно использовать для этих целей [artillery](https://artillery.io/)) **+30 баллов**

## Штрафы: (отсутствуют)
* Наличие изменений в тестах либо в workflow **минус 200 баллов**
* Внесение изменений в репозиторий после дедлайна не считая коммиты, вносящие изменения только в `Readme.md` и другую документацию) **минус 30% от максимального балла за задание (для этого задания 72 балла)**
* За отсутствие отдельной ветки для разработки **-20 баллов**
* За отсутствие `Pull Request` **-20 баллов**
* За неполную информацию в описании `Pull Request` (отсутствует либо некорректен один из 3 обязательных пунктов) **-10 баллов**
* За **каждую** ошибку линтера при запуске `npm run lint` на основе **локального конфига** -5 баллов (именно `errors`, не `warnings`)
* За каждый непроходящий тест npm run test:auth **-20 баллов**
* Меньше 3 коммитов (не считая коммиты, вносящие изменения только в `Readme.md` и другую документацию) — **-20 баллов**

### Тестирование режимов работы
|                      |    Express         |     Fastify               |
|--------------|---------------|---------------|
| Scenarios launched     | 4953   |    4996        |
|Scenarios completed  |4953 |      4996       |
| Requests completed     | 14859   |     14988        |
|Mean response/sec    | 79.82  |      80.51       |
|Response time (msec):  |             |
|     min       | 3     |       3     |
|     max | 331    |    322        |
|     median      | 6      |    5        |
|     p95       |123     |       115     |
|     p99       |162     |     140       |
|      Scenario counts:       |    |            |
|   Get all Users       | 4953 (100%)     |     4996 (100%)       |
|  Codes:       |     |            |
|   200      | 9906     |    9992        |
|   201      | 4953     |       4996     |
